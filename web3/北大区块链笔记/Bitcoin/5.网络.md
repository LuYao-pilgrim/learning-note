# 网络

bitcoin network运行在应用层

![](C:\Users\陆遥\Desktop\DailyExperience\笔记\images\2023-01-18-11-22-58-image.png)

比特币网络中的P2P网络是很简单的，所有结点之间都是对等的，没有超级结点。要加入这个网络，至少要有一个种子结点（seed node），和种子结点联系，它会告知它所知道的网络中的其它结点（有点像构造路由表的过程）。结点之间通过TCP来通信，有利于穿透防火墙。要离开网络也不必通知其它结点，只需要直接退出应用程序，其它结点一直没有听到你的消息，过一段时间就会将你删除掉。

## 设计原则

simple, robust, but not efficient

1.通过flooding原则传播，收到消息传播给邻居节点。邻居结点的选取是随机的，没有考虑底层的拓扑结构。比如美国的一个结点可能和中国的一个结点是邻居结点。这样设计的好处是增强鲁棒性（强健，防风险），牺牲了效率。

2.解答问题-->如何保证所有有效交易都能上链？

每个全节点维护一个未上链交易合集，不会装载冲突的交易。一个节点集合里面有A->B，那么收到新区块，不管A->B还是冲突的A->C（代表A->B违法）都去删掉这个A->B。

想知道 如果最长合法链被另一条链取代了，但各个节点删掉的集合里的一些交易在另一个链里没被写入，这时集合里的交易不就乱套了吗。

-->如果是诚实节点就不会听他的呀，因为公钥对不上，只能51攻击。
